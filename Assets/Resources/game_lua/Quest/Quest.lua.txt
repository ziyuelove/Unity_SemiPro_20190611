--Author : Administrator
--Date   : 2014/11/25

--声明，这里声明了类名还有属性，并且给出了属性的初始值。
Quest= {id = 0,complated = false}

--这句是重定义元表的索引，就是说有了这句，这个才是一个类。
Quest.__index = Quest

--构造体，构造体的名字是随便起的，习惯性改为New()
function Quest:New(id) 
    local self = {};    --初始化self，如果没有这句，那么类所建立的对象改变，其他对象都会改变
    setmetatable(self, Quest);  --将self的元表设定为Class
    self.id = id;
	self.Complated = false; 
	self.conditions = {};    --任务完成的条件达成标识
	self:init();
    return self;    --返回自身
end

--测试打印方法--
function Quest:test() 
	Debug.Log("Quest:test~~~~~~~~~~~~~~~~~~~"..self.id);
end

--初始化时拷贝任务完成标识
function Quest:init()
	local questConfig = questmaneger.findQuestFormConfig(self.id);
	if questConfig~=nil then
		for key, value in pairs(questConfig.conditions) do 
			local conditiondata={};
			 conditiondata.type = value.type;
			 conditiondata.target = value.target;
			 conditiondata.value = value.value;
			 conditiondata.curValue = 0;
			 table.insert (self.conditions,conditiondata);
		end

		self:refreshItem();
	end
end

--刷新任务的道具条件
function Quest:refreshItem()
	for key, value in pairs(self.conditions) do 
		if value.type == 2 then
			local ItemId = value.target;
			local playerItemNum = itemmaneger.GetItemNum(ItemId);
			value.curValue = playerItemNum;
		end
	end
	self:refreshComplated()
end

function Quest:refreshComplated()
	local canConplated = true;
	for key, value in pairs(self.conditions) do 
		if value.curValue < value.value then
			canConplated = false;
		end
	end
	self.Complated = canConplated;
end

--刷新任务
function Quest:refresh(type,value1,value2)
end

--endregion
